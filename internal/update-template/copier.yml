_min_copier_version: "9.0"
_subdirectory: .

# Internal maintainer utility: update one existing template directory with current common assets.

target_template:
  type: str
  help: Name of the template directory under templates/ to refresh (e.g. gist, sst, typescript)

include_chatmodes:
  type: bool
  default: true
  help: Copy shared .github/chatmodes files

include_instructions:
  type: bool
  default: true
  help: Copy shared .github/instructions files

include_prompts:
  type: bool
  default: true
  help: Copy shared .github/prompts files

include_mcp:
  type: bool
  default: true
  help: Copy shared .vscode/mcp files

overwrite_mode:
  type: str
  choices:
    - overwrite
    - skip
  default: overwrite
  help: Overwrite existing files or skip them

_message_after_copy: |
  Updated template '{{ target_template }}' with selected common assets.

_tasks:
  - |
    bash -c '
    set -euo pipefail; T="{{ target_template }}";
    if [ ! -d templates/$T ]; then echo "Template directory templates/$T not found" >&2; exit 1; fi;
    RSYNC_BASE=(rsync -a --exclude README.md);
    {% if overwrite_mode == 'skip' %} RSYNC_BASE+=(--ignore-existing); {% endif %}
    {% if include_chatmodes %} mkdir -p templates/$T/.github/chatmodes; "${RSYNC_BASE[@]}" common/.github/chatmodes/ templates/$T/.github/chatmodes/; {% endif %}
    {% if include_instructions %} mkdir -p templates/$T/.github/instructions; "${RSYNC_BASE[@]}" common/.github/instructions/ templates/$T/.github/instructions/; {% endif %}
    {% if include_prompts %} mkdir -p templates/$T/.github/prompts; "${RSYNC_BASE[@]}" common/.github/prompts/ templates/$T/.github/prompts/; {% endif %}
    {% if include_mcp %} mkdir -p templates/$T/.vscode; "${RSYNC_BASE[@]}" common/.vscode/ templates/$T/.vscode/; {% endif %}
    echo "Done updating $T."
    '
